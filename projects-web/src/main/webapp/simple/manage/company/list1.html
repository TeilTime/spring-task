


<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <title>机构管理</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="../../../public/js/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="../../../public/style/admin.css" media="all">
  <script type="text/javascript" src="../../../public/js/jquery-2.2.2.min.js"></script>
  <script type="text/javascript" src="../../../public/js/layui/layui.all.js"></script>
</head>
<body>
<style>
  #table_data input{
    width: 100%;
    height: 30px;
    line-height: 30px;
    margin: 10px 0;
  }
  #table_data{
    padding: 0 10px;
    box-sizing: border-box;
  }
</style>

<div class="main layadmin-tabspage-none">
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header">
      <!-- 头部区域 -->
      <ul class="layui-nav layui-layout-left">
        <li class="layui-nav-item layadmin-flexible" lay-unselect>
          <a href="javascript:;" layadmin-event="flexible" title="侧边伸缩">
            <i class="layui-icon layui-icon-shrink-right" id="LAY_app_flexible"></i>
          </a>
        </li>
        <!--<li class="layui-nav-item layui-this layui-hide-xs layui-hide-sm layui-show-md-inline-block">
          <a lay-href="" title="">
            控制台
          </a>
        </li>-->
        <li class="layui-nav-item layui-hide-xs" lay-unselect>
          <a href="http://www.layui.com/admin/" target="_blank" title="前台">
            <i class="layui-icon layui-icon-website"></i>
          </a>
        </li>
        <li class="layui-nav-item" lay-unselect>
          <a href="javascript:;" layadmin-event="refresh" title="刷新">
            <i class="layui-icon layui-icon-refresh-3"></i>
          </a>
        </li>
        <li class="layui-nav-item layui-hide-xs" lay-unselect>
          <input type="text" placeholder="搜索..." autocomplete="off" class="layui-input layui-input-search" layadmin-event="serach" lay-action="template/search/keywords=">
        </li>
      </ul>
      <ul class="layui-nav layui-layout-right" lay-filter="layadmin-layout-right">

        <li class="layui-nav-item" lay-unselect>
          <a lay-href="app/message/" layadmin-event="message">
            <i class="layui-icon layui-icon-notice"></i>

            <!-- 如果有新消息，则显示小圆点 -->
            <script type="text/html" template lay-url="./json/message/new.js">
              {{# if(d.data.newmsg){ }}
              <span class="layui-badge-dot"></span>
              {{# } }}
            </script>

          </a>
        </li>
        <li class="layui-nav-item layui-hide-xs" lay-unselect>
          <a href="javascript:;" layadmin-event="theme">
            <i class="layui-icon layui-icon-theme"></i>
          </a>
        </li>
        <li class="layui-nav-item layui-hide-xs" lay-unselect>
          <a href="javascript:;" layadmin-event="note">
            <i class="layui-icon layui-icon-note"></i>
          </a>
        </li>
        <li class="layui-nav-item layui-hide-xs" lay-unselect>
          <a href="javascript:;" layadmin-event="fullscreen">
            <i class="layui-icon layui-icon-screen-full"></i>
          </a>
        </li>
        <li class="layui-nav-item" lay-unselect>
          <script type="text/html" template lay-url="./json/user/session.js"
                  lay-done="layui.element.render('nav', 'layadmin-layout-right');">
            <a href="javascript:;">
              <cite>{{ d.data.username }}</cite>
            </a>
            <dl class="layui-nav-child">
              <dd><a lay-href="set/user/info">基本资料</a></dd>
              <dd><a lay-href="set/user/password">修改密码</a></dd>
              <hr>
              <dd layadmin-event="logout" style="text-align: center;"><a>退出</a></dd>
            </dl>
          </script>
        </li>

        <li class="layui-nav-item layui-hide-xs" lay-unselect>
          <a href="javascript:;" layadmin-event="about"><i class="layui-icon layui-icon-more-vertical"></i></a>
        </li>
        <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-unselect>
          <a href="javascript:;" layadmin-event="more"><i class="layui-icon layui-icon-more-vertical"></i></a>
        </li>
      </ul>
    </div>
    <div  th:include="/simple/public/public_menu :: navMenu"></div>
    <div class="layui-body" id="LAY_app_body">
      <div class="layadmin-tabsbody-item layui-show">
        <button id="treeEditBtn" class="layui-btn layui-btn-sm" >
          <i class="layui-icon">&#xe642;</i> 修改
        </button>
        <button id="treeAddBtn" class="layui-btn layui-btn-sm">
          <i class="layui-icon">&#xe608;</i> 添加
        </button>
        <button id="treeDelBtn" class="layui-btn layui-btn-sm">
          <i class="layui-icon">&#xe640;</i> 删除
        </button>
        <button id="addLimit" class="layui-btn layui-btn-sm">
          <i class="layui-icon">&#xe640;</i> 授权
        </button>

        <input id="organId" value="0" hidden="hidden">
        <div id="demoTree"></div>

        <div class="layui-fluid"  style="width: 76%;float: left;padding:0px 20px;box-sizing: border-box;">
          <div class="layui-card">
            <!--<div class="layui-form layui-card-header layuiadmin-card-header-auto" lay-filter="layadmin-userfront-formlist">-->
              <!--<div class="layui-form-item">-->
                <!--<div class="layui-inline">-->
                  <!--<label class="layui-form-label">组织名称</label>-->
                  <!--<div class="layui-input-block">-->
                    <!--<input id="groupName" type="text" placeholder="请输入" autocomplete="off" class="layui-input">-->
                  <!--</div>-->
                <!--</div>-->
                <!--<div class="layui-inline">-->
                <!--<label class="layui-form-label">组织编码</label>-->
                <!--<div class="layui-input-block">-->
                  <!--<input id="code" type="text" placeholder="请输入" autocomplete="off" class="layui-input">-->
                <!--</div>-->
                <!--</div>-->
                <!--<div class="layui-inline">-->
                  <!--<button  class="layui-btn layuiadmin-btn-useradmin" id="searchButton">-->
                    <!--<i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>-->
                  <!--</button>-->
                <!--</div>-->
              <!--</div>-->
            <!--</div>-->
            <table id="demo" lay-filter="demo">
              <thead>
              <tr>
                <th lay-data="{type:'checkbox',field:'id'}">ID</th></i>
                <th lay-data="{field:'name', width:200}">角色名称</th>
                <th lay-data="{field:'trueName', width:200}">真实姓名</th>
                <th lay-data="{field:'status', width:200}">当前状态</th>
                <th lay-data="{field:'isLeader', width:200}">是否为组长</th>
              </tr>
              </thead>
            </table>
            <div id="page" style="padding-left: 20px"></div>
            <script type="text/html" id="imgTpl">
              <img style="display: inline-block; width: 50%; height: 100%;" src= {{ d.avatar }}>
            </script>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--表头工具模板-->
<script type="text/html" id="toolbarDemo">
  <div class="layui-btn-container">
    <button class="layui-btn layui-btn-sm" lay-event="setLoader">设为组长</button>
    <button class="layui-btn layui-btn-sm" lay-event="remLoader">取消组长</button>
    <button class="layui-btn layui-btn-sm" lay-event="del">移除用户</button>
  </div>
</script>

<!--操作列模板-->
<!--<script type="text/html" id="barDemo">-->
  <!--<a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>-->
  <!--<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>-->
  <!--<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>-->
<!--</script>-->


<!--弹出层模板（删除）-->
<script type="text/html"  id="delTableTemplate">
  <br><p>&emsp;&emsp;是否删除数据</p>
  <input hidden="hidden" value="{{d.ids}}">
  </script>

<script type="text/html"  id="updateLoaderTemplate1">
  <br><p>&emsp;&emsp;是否设置为组长？</p>
  <!--<input hidden="hidden" value="{{d.ids}}">-->
</script>

<script type="text/html"  id="updateLoaderTemplate2">
  <br><p>&emsp;&emsp;是否取消组长？</p>
  <!--<input hidden="hidden" value="{{d.ids}}">-->
</script>

<!--弹出层模板（新增，查看，编辑）-->
<script type="text/html"  id="tableDataTemplate">

  <div class="layui-row layui-col-space30">
    <div class="layui-col-md12">
      <div class="grid-demo grid-demo-bg0">
        {{# if(d.disable == 0){ }}
        <span>组织名称：</span> <input class="name" type="text" value="{{d.name}}" disabled="disabled">
        {{#}else if(d.disable == 1){ }}
        <span>组织名称：</span> <input class="name" type="text" value="{{d.name}}">
        {{# }else{ }}
        <span>组织名称：</span> <input class="name" type="text">
        {{# } }}
      </div>
    </div>
  </div>

  <div class="layui-row layui-col-space30">
  <div class="layui-col-md12">
    <div class="grid-demo">
      {{# if(d.disable == 0){ }}
      <span>组织描述：</span> <input class="desc" type="text" value="{{d.desc}}" disabled="disabled">
      {{#}else if(d.disable == 1){ }}
      <span>组织描述：</span> <input class="desc" type="text" value="{{d.desc}}">
      {{# }else{ }}
      <span>组织描述：</span> <input class="desc" type="text">
      {{# } }}
    </div>
  </div>
  </div>

  <div class="layui-row layui-col-space30">
    <div class="layui-col-md12">
      <div class="grid-demo grid-demo-bg0">
        {{# if(d.disable == 0){ }}
        <span>组织地址：</span> <input class="address" type="text" value="{{d.address}}" disabled="disabled">
        {{#}else if(d.disable == 1){ }}
        <span>组织地址：</span> <input class="address" type="text" value="{{d.address}}">
        {{# }else{ }}
        <span>组织地址：</span> <input class="address" type="text">
        {{# } }}
      </div>
    </div>
  </div>


  <div class="layui-row layui-col-space30">
    <div class="layui-col-md12">
      <div class="grid-demo grid-demo-bg0">
        {{# if(d.disable == 0){ }}
        <span>手机号码：</span> <input class="mobile" type="text" value="{{d.mobile}}" disabled="disabled">
        {{#}else if(d.disable == 1){ }}
        <span>手机号码：</span> <input class="mobile" type="text" value="{{d.mobile}}">
        {{# }else{ }}
        <span>手机号码：</span> <input class="mobile" type="text">
        {{# } }}
      </div>
    </div>
  </div>

  <div class="layui-row layui-col-space30">
    <div class="layui-col-md12">
      <div class="grid-demo grid-demo-bg0">
        {{# if(d.disable == 0){ }}
        <span>座机号码：</span> <input class="phone" type="text" value="{{d.phone}}" disabled="disabled">
        {{#}else if(d.disable == 1){ }}
        <span>座机号码：</span> <input class="phone" type="text" value="{{d.phone}}">
        {{# }else{ }}
        <span>座机号码：</span> <input class="phone" type="text">
        {{# } }}
      </div>
    </div>
  </div>

  <div class="layui-row layui-col-space30">
    <div class="layui-col-md12">
      <div class="grid-demo grid-demo-bg0">
        {{# if(d.disable == 0){ }}
        <span>组织QQ：</span> <input class="qq" type="text" value="{{d.qq}}" disabled="disabled">
        {{#}else if(d.disable == 1){ }}
        <span>组织QQ：</span> <input class="qq" type="text" value="{{d.qq}}">
        {{# }else{ }}
        <span>组织QQ：</span> <input class="qq" type="text">
        {{# } }}
      </div>
    </div>
  </div>

  <div class="layui-row layui-col-space30">
    <div class="layui-col-md12">
      <div class="grid-demo grid-demo-bg0">
        {{# if(d.disable == 0){ }}
        <span>组织邮箱：</span> <input class="email" type="text" value="{{d.email}}" disabled="disabled">
        {{#}else if(d.disable == 1){ }}
        <span>组织邮箱：</span> <input class="email" type="text" value="{{d.email}}">
        {{# }else{ }}
        <span>组织邮箱：</span> <input class="email" type="text">
        {{# } }}
      </div>
    </div>
  </div>

  <div class="layui-row layui-col-space30">
    <div class="layui-col-md12">
      <div class="grid-demo grid-demo-bg0">
        {{# if(d.disable == 0){ }}
        <span>组织编码：</span> <input class="code" type="text" value="{{d.code}}" disabled="disabled">
        {{#}else if(d.disable == 1){ }}
        <span>组织编码：</span> <input class="code" type="text" value="{{d.code}}">
        {{# }else{ }}
        <span>组织编码：</span> <input class="code" type="text">
        {{# } }}
      </div>
    </div>
  </div>
        <input hidden="hidden" class="disable" value="{{d.disable}}">
        <input hidden="hidden" class="id" value="{{d.id}}">
      </div>
</script>

<script type="text/html" id="uploadTemplate">
  <div class="layui-upload-drag" id="test10">
    <i class="layui-icon"></i>
    <p>点击上传，或将文件拖拽到此处</p>
  </div>
</script>

<!--权限-->
<script type="text/html"  id="limitTemplate">
  <div class="layui-tab" lay-allowClose="true">
    <ul class="layui-tab-title">
      {{# layui.each(d, function(index, item){ }}
      {{# if(index==0){ }}
      <li class="layui-this">{{item.name}}</li>
      {{# }else{ }}
      <li>{{item.name}}</li>
      {{# } }}
      {{# }); }}

    </ul>
    <div class="layui-tab-content allCkeckTrue">
      {{# layui.each(d, function(index, item){ }}

      {{# if(index==0){ }}
      <div class="layui-tab-item layui-show">
        {{# layui.each(item.list, function(index1, item1){ }}
        <input type="checkbox" value="{{item1.id}}">{{item1.rightName}}
        {{# }); }}
      </div>
      {{# }else{ }}
      <div class="layui-tab-item">
        {{# layui.each(item.list, function(index1, item1){ }}
        <input type="checkbox" value="{{item1.id}}">{{item1.rightName}}
        {{# }); }}
      </div>

      {{# } }}

      {{# }); }}
    </div>
  </div>


</script>


<script th:inline="none" type='module'>

    import  base from "../../../public/js/common/base.js";
    import conslog from "../../../public/js/common/conslog.js";
    import menu from "../../../public/js/common/menu.js";
    import common from "../../../public/js/common/common.js";




    var cons = new conslog();
    var url = "/manage/organ";
    var baseOrder = [];
    var tempSize = 10;
    
    $(function(){
        var tempMenu = new menu();

        tempMenu.findMenu();
//        TempdoList(1,tempSize,"id",true);
        getRoleTree();
        findUser();

        $('#searchButton').click(function() {
            TempdoList(1,tempSize,"id",true);
        })

        $(document).on('click','#treeEditBtn',function(){
            var data = JSON.parse($('#organId').val())
            if(data=='0'){
                layui.layer.msg("请选择需要修改的数据！");
                return false;
            }
            setOpenData( data,1);
        })
        $(document).on('click','#treeAddBtn',function(){
            var data = JSON.parse($('#organId').val());
            var data1 = {};
            if(data==0){
                data1.id=0;
                setOpenData( data1,2);
            }else{
                setOpenData( data,2);
            }
        })
        $(document).on('click','#treeDelBtn',function(){
            var data = JSON.parse($('#organId').val());
            if(data==0){
                layui.layer.msg('请选择需要删除的数据!');
                return false;
            }else{
                doTopDelete(data,1);
            }
        })
        $(document).on('click','#addLimit',function(){
            var data = JSON.parse($('#organId').val());
            if(data==0){
                layui.layer.msg('请选择需要授权的数据!');
                return false;
            }else{
                tempLimit(data.id);
            }



        })

    });

  //新增数据方法
    function doAdd(data){
        let tempBase = new base(url,JSON.stringify(data),"");
        tempBase.add().then(res=>{
            $("#tempMsg").text(res.msg);
        }).catch(res=>{

        })
    }
    //更新方法
    function doUpdate(data){
    let tempBase = new base(url,JSON.stringify(data),data.id);
    tempBase.updata().then(res=>{
        $("#tempMsg").text(res.msg);
    }).catch(res=>{

    })
    }
    //根据id查询数据
    function doView() {
        let tempBase = new base(url,"","1");
        tempBase.view().then(res=>{
            var temp = [];
            temp.push(res.obj);
            setTableData(temp);
            cons.consoleLog(temp);
        }).catch(res=>{

        })
        
    }
    //删除
    function doDelete() {
        let tempBase = new base(url,user,1);
        tempBase.delete().then(res=>{
           cons.consoleLog(res)
        }).catch(res=>{

        })
    }
    //根据ids批量删除
    function doDeleteByIds(data) {
        let tempBase = new base(url,data,'');
        tempBase.deleteByIds().then(res=>{
            cons.consoleLog(res)
            $("#tempDel").text(res.msg);
        }).catch(res=>{

        })
    }

    //根据ids批量删除
    function doTableDelByIds(data) {
        let tempBase = new base('/manage/organUser',data,'');
        tempBase.deleteByIds().then(res=>{
            cons.consoleLog(res)
            $("#tempDel").text(res.msg);
        }).catch(res=>{

        })
    }



    //条件列表查询
    function doList(current,size,cloum,sort) {
        var data = getSearchCondition();
        var sortProps = [];
        if(baseOrder.length>0){
            sortProps = baseOrder;
        }else{
            sortProps.push({key:cloum,value:sort});
        }
        data.pager = {current:current,size:size};
        data.pager.sortProps = sortProps;
        let tempBase = new base(url,JSON.stringify(data),"");
        tempBase.list().then(res=>{
            cons.consoleLog(res);
//            if(current==1){
//                page(res.obj.total);
//            }
            setTableData(res.obj.records);
        }).catch(res=>{

        })
    }

    //条件列表查询
    function TempdoList(current,size,cloum,sort) {
        var sortProps = [];
        var data=getSearchCondition();
        if(baseOrder.length>0){
            sortProps = baseOrder;
        }else{
            sortProps.push({key:cloum,value:sort});
        }
        data.pager = {current:current,size:size};
        data.pager.sortProps = sortProps;
        let tempBase = new base(url,JSON.stringify(data),"");
        tempBase.list().then(res=>{
            cons.consoleLog(res);
            page(res.obj.total);
            setTableData(res.obj.records);
        }).catch(res=>{

        })
    }

    //渲染数据到table
    function setTableData(data) {
        var temp1 = "id";
        var temp2 ="asc";
        if(baseOrder.length>0){
            temp1 = baseOrder[0].key;
        if(baseOrder[0].value==true){
            temp2 = "asc";
        }else{
            temp2 = "desc"
        }
        }
            layui.table.init('demo', {
                height: 550 //设置高度
                ,limit: tempSize //注意：请务必确保 limit 参数（默认：10）是与你服务端限定的数据条数一致
                //支持所有基础参数
                ,data:data
                ,skin: 'line' //表格风格
                ,even: true
//                ,limits: [5, 7, 10]
                ,autoSort:false
                ,toolbar: '#toolbarDemo'
                ,initSort: {
                    field: temp1 //排序字段，对应 cols 设定的各字段名
                    ,type: temp2 //排序方式  asc: 升序、desc: 降序、null: 默认排序
                }
            });
    }

    //监听排序事件
//    layui.table.on('sort(demo)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
//        console.log(obj.field); //当前排序的字段名
//        console.log(obj.type); //当前排序类型：desc（降序）、asc（升序）、null（空对象，默认排序）
//        console.log(this); //当前排序的 th 对象
//        var tempList = [];
//        var order = {};
//        var sort;
//        if(obj.type=="asc"){
//            sort=true;
//        }else{
//            sort = false;
//        }
//        order.key = obj.field;
//        order.value = sort;
//        tempList.push(order);
//        baseOrder=tempList;
//        doList(1,tempSize,"id",true);
//    });


    //监听操作列工具条
//    layui.table.on('tool(demo)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
//        var data = obj.data; //获得当前行数据
//        var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
//        var tr = obj.tr; //获得当前行 tr 的DOM对象
//
//        if(layEvent === 'detail'){ //查看
//            setOpenData(data,0);
//        } else if(layEvent === 'del'){ //删除
//            doTopDelete(obj.data,1)
//        } else if(layEvent === 'edit'){ //编辑
//            setOpenData(data,1);
//        }
//    });
    //头部工具
    layui.table.on('toolbar(demo)', function(obj){
        var checkStatus = layui.table.checkStatus(obj.config.id);
        switch(obj.event){
            //设为组长
            case 'setLoader':
                setLoaderData(checkStatus.data,1,"设置组长");
                break;
            //取消组长
            case 'remLoader':
                setLoaderData(checkStatus.data,0,"设置组长");
                break;
            //移除用户
            case 'del':
//               uploadData()
                doCloumDelete(checkStatus.data,2);
                break;
        }
    });

    //tree处删除
    function doTopDelete(data1,type) {
        var data = {};
        var ids = "";
        if(type==2){
          /* <![CDATA[ */
            for(var i=0;i<data1.length;i++){
                ids = ids + data1[i].id + ","
            }
          /* ]]> */
            data.ids = ids.substring(0,ids.length-1);
        }else{
            data.ids = data1.id;
        }
        setDeleData(data,1);
    }
    //table处删除
    function doCloumDelete(data1,type) {
        var data = {};
        var ids = "";
        if(type==2){
          /* <![CDATA[ */
            for(var i=0;i<data1.length;i++){
                ids = ids + data1[i].id + ","
            }
          /* ]]> */
            data.ids = ids.substring(0,ids.length-1);
        }else{
            data.ids = data1.id;
        }
        setDeleData(data,2);
    }

//设置弹出层数据（新增，查看，修改）
    function setOpenData(data,type) {
        data.disable = type;
        layui.layer.open({
            type: 1,
            title:"数据<span style='color: red;float:right' id='tempMsg'>",
            area:['500px','500px'],
            closeBtn: 0, //关闭按钮（0：不显示，1：显示）
            anim: 2,
            shadeClose: true, //开启遮罩关闭
            btn: ['确定','取消'],
            content: '<div id="table_data"></div>',
            yes: function(index, layero){
                if(type!=0){
                getOpenData(data);
                }else{
                    layui.layer.close(index);
                }
            },
            btn2:function (index,layero) {
                if(type!=0){
                location.reload();
                }
            },
            end:function () {
                if(type!=0){
                location.reload();
                }
            }

        });
        layui.laytpl($("#tableDataTemplate").html()).render(data, function(html){
            $("#table_data").html(html)
        });
    }

    //弹出层渲染（删除）
    function setDeleData(data,type) {
        layui.layer.open({
            type: 1,
            title:"删除数据 <span style='color: red;float:right' id='tempDel'>",
            area:['400px','200px'],
            closeBtn: 0, //关闭按钮（0：不显示，1：显示）
            anim: 2,
            shadeClose: true, //开启遮罩关闭
            btn: ['确定','取消'],
            content: '<div id="table_del"></div>',
            yes: function(index, layero){
                if(type==1) {
                    doDeleteByIds(data);
                }else if(type==2){
                    doTableDelByIds(data);
                }
            },
            btn2:function (index,layero) {
                location.reload();
            },
            end:function () {
                location.reload();
            }

        });
        layui.laytpl($("#delTableTemplate").html()).render(data, function(html){
            $("#table_del").html(html)
        });
    }
    //弹出层渲染（修改组长信息）
    function setLoaderData(temp,type,title) {
        layui.layer.open({
            type: 1,
            title:title+" <span style='color: red;float:right' id='tempUpdateLoader'>",
            area:['400px','200px'],
            closeBtn: 0, //关闭按钮（0：不显示，1：显示）
            anim: 2,
            shadeClose: true, //开启遮罩关闭
            btn: ['确定','取消'],
            content: '<div id="table_loader"></div>',
            yes: function(index, layero){
                setLeader(temp,type)
            },
            btn2:function (index,layero) {
                location.reload();
            },
            end:function () {
                location.reload();
            }

        });
        if(type==0){
            setLoaderTemplate('updateLoaderTemplate2','table_loader');
        }else{
            setLoaderTemplate('updateLoaderTemplate1','table_loader');
        }

//       layui.laytpl($("#updateLoaderTemplate1").html()).render(data, function(html){
//           $("#table_loader").html(html)
//       });
    }
    //渲染设置组长弹框数据
    function setLoaderTemplate(divId,htmlId) {
        layui.laytpl($("#"+divId).html()).render({}, function(html){
            $("#"+htmlId).html(html)
        });
    }

//    //批量导入
//    function uploadData() {
//
//
//        layui.layer.open({
//
//            type: 1
//            ,offset: "auto" //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
//            ,id: 'layer_importData' //防止重复弹出
//            ,title:"批量导入 <span style='color: red;float:right' id='tempUpload'>"
//            ,content: '<div id="upLoadData"></div>'
//            ,maxWidth:800
//            ,btn: ['下载模板']
//            ,btnAlign: 'c' //按钮居中
//            ,shade: 0 //不显示遮罩
//            ,yes: function(index, layero){
//              alert(1111)
//            },
//
//        });
//        layui.laytpl($("#uploadTemplate").html()).render({}, function(html){
//            $("#upLoadData").html(html)
//        });
//        bindUpload();
//
//    }
//    //绑定upload事件
//    function bindUpload() {
//        //批量导入（下载模板）
//        layui.upload.render({
//            elem: '#test10'
//            ,accept:"file"
//            ,url: url+'/uploadExcel'
//
//            ,done: function(res){
//                console.log(res)
//            }
//        });
//    }

    //添加权限弹出层
    function tempLimit(ids) {
        layui.layer.open({
            type: 1,
            title:"权限<span style='color: red;float:right' id='tempLimit'>",
            area:['1000px','1000px'],
            closeBtn: 0, //关闭按钮（0：不显示，1：显示）
            anim: 2,
            shadeClose: true, //开启遮罩关闭
            btn: ['确定','取消'],
            content: '<div id="demoLimit"></div>',
            yes: function(index, layero){
                getAllCheckTrue(ids);

            },
            btn2:function (index,layero) {
                location.reload();
            },
            end:function () {
                location.reload();
            }

        });

        findLimitList();

    }

    //添加权限
    function getAllCheckTrue(ids) {
        var limitIds = '';
        $.each($('.allCkeckTrue input:checkbox:checked'),function () {
            limitIds = limitIds+$(this).val()+',';
        })
//        cons.consoleLog(limitIds);
        addLimit(ids,limitIds);


    }




    //渲染分页
    function page(total) {
        layui.laypage.render({
            elem: 'page'
            ,count: total //数据总数，从服务端得到
            ,layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
            ,jump: function(obj, first){
                //obj包含了当前分页的所有参数，比如：
                cons.consoleLog(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                cons.consoleLog(obj.limit); //得到每页显示的条数
                tempSize = obj.limit;
                //首次不执行
                if(!first){
                    //do something
//                    doList(obj.curr,obj.limit,"id",true);
                    findUserPage(obj.curr,obj.limit);
                }
            }
        });
    }
    //弹出层按钮触发
    function getOpenData(data1) {
        var disable = $(".disable").val();
        if(disable==0){
            return false;
        }
        var data = {};
        data.name = $(".name").val();
        data.desc = $(".desc").val();
        data.address = $(".address").val();
        data.mobile = $(".mobile").val();
        data.phone = $(".phone").val();
        data.qq = $(".qq").val();
        data.email = $(".email").val();
        data.code = $(".code").val();



      if(disable==1){
          data.id = $(".id").val();
          doUpdate(data);
        }else{
          data.parentId = data1.id;
          doAdd(data);
      }
    }

    function getSearchCondition() {
        var data = {};
        var entity = {}
        entity.name = $("#groupName").val();
        entity.code = $("#code").val();
        data.entity = entity;
        return data;
    }

    //获取tree结构数据
    function getRoleTree() {
        var para = {};
        para.url = url + "/getOrganTree";
        para.type = 'get';
        para.data = {};
        para.async = true;
        let comm = new common();
        comm.ajax(para).then(res=>{

            showTree(res.obj);

        }).catch(res=>{

        });

    }

    //渲染树结构
    function showTree(data) {

        layui.use('tree', function(){
            var tree = layui.tree;
            tree({
                elem: '#demoTree' //传入元素选择器
                ,nodes: data
                ,click: function(node){
                    console.log(node) //node即为当前点击的节点数据
                    $('#organId').val( JSON.stringify(node));
                    findUser(node.id);
                }
            });
        });
    }

    //获取ids
    function getIds(data1) {
        var ids='';
      /* <![CDATA[ */
        for(var i=0;i<data1.length;i++){
            ids = ids + data1[i].id + ","
        }
      /* ]]> */
        ids = ids.substring(0,ids.length-1);
        return ids;
    }
    //设置组长
    function setLeader(temp,type) {
        var ids = getIds(temp);
        var data = {};
        data.ids = ids;
        data.type=type;
        var para={};
        para.url = "/manage/organUser/updateLoader";
        para.type = 'get';
        para.data = data;
        para.async = true;


        let comm = new common();
        comm.ajax(para).then(res=>{

            cons.consoleLog(res);
            successMsg(res);
//           setTableData(res.obj.list);

        }).catch(res=>{

        });

    }

    //提示
    function successMsg(res) {
        if(res.success){
            layui.layer.msg('操作成功');
        }else{
            layui.layer.msg('操作失败');
        }
    }



    //获取机构下用户
    function findUser(organId) {
        var data = {};
        var entity = {};
//      entity.id = $('#roleId').val();
        entity.id=organId;
        var pager ={};
        pager.current=1;
        pager.size=10;
        var data = {pager:pager,entity:entity};

        var para = {};
        para.url = "/manage/organUser/getUser";
        para.type = 'post';
        para.data = JSON.stringify(data);
        para.async = true;
        let comm = new common();
        comm.ajax(para).then(res=>{

//            cons.consoleLog(res);
            setTableData(res.obj.list);
            page(res.obj.total);

        }).catch(res=>{

        });
    }

    //查询权限数据
    function findLimitList(){
        var para = {
            url : "/manage/limit/getTypeList",
            type : 'get',
            data : {},
            async : true
        }
        let comm = new common();
        comm.ajax(para).then(res=>{
            cons.consoleLog(res);
            layui.laytpl($("#limitTemplate").html()).render(res.obj, function(html){
                $("#demoLimit").html(html)
            });

        }).catch(res=>{

        })
    }

    //添加权限，调用添加权限接口
    function addLimit(paraIds,limitIds) {
        var para = {
            url : "/manage/limitRelation/setLimit",
            type : 'get',
            data : {paraIds:paraIds,limitIds:limitIds,type:'2'},
            async : true
        }
        let comm = new common();
        comm.ajax(para).then(res=>{
            cons.consoleLog(res);

        }).catch(res=>{

        })

    }

    //获取机构下用户分页
    function findUserPage(current,size) {
        var organId = JSON.parse($('#organId').val()).id;
        var data = {};
        var entity = {};
//      entity.id = $('#roleId').val();
        entity.id=organId;
        var pager ={};
        pager.current=current;
        pager.size=size;
        var data = {pager:pager,entity:entity};

        var para = {};
        para.url = "/manage/organUser/getUser";
        para.type = 'post';
        para.data = JSON.stringify(data);
        para.async = true;
        let comm = new common();
        comm.ajax(para).then(res=>{

//            cons.consoleLog(res);
            setTableData(res.obj.list);

        }).catch(res=>{

        });
    }



</script >
</body>
</html>