﻿<title>组织管理</title>

<style>
  .userForm .layui-tab{margin:0;}
  .userForm .layui-tab-title li{padding:0 35px;background-color: rgba(248, 248, 248, 1);}
  .userForm .layui-input{    width: 80%; float:left;}
  .userForm .layui-form-item{    margin-bottom: 10px;}
  .userForm .tipspan{font-size: 10px; line-height: 15px;}
  .userForm .button-bar{text-align: center;}
  .userForm .bitianspan {
    height: 40px;
    line-height: 40px;
    margin-left: 20px;
    color: #FF6600;
  }

  .layui-card-header.layuiadmin-card-header-auto{padding-top:10px;padding-bottom: 10px;}
  th .layui-table-cell{text-align: center}
</style>

<div class="layui-card layadmin-header">
  <div class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">主页</a>
    <a><cite>用户</cite></a>
    <a><cite>系统用户</cite></a>
  </div>
</div>

<div class="layui-fluid">
  <div class="layui-row layui-col-space12">
    <div class="layui-col-md3 md3-left">
      <div class="layui-card h100">
        <div class="layui-card-header">组织管理</div>
        <div class="layui-card-body">
          <div class="layui-btn-container">
            <button type="button" class="layui-btn layui-btn-xs" data-type="add">
              <i class="layui-icon">&#xe608;</i> 添加
            </button>
            <button type="button" class="layui-btn layui-btn-xs" data-type="edit">
              <i class="layui-icon">&#xe642;</i> 修改
            </button>
            <button type="button" class="layui-btn layui-btn-xs" data-type="del">
              <i class="layui-icon">&#xe640;</i> 删除
            </button>
            <button class="layui-btn layui-btn-xs" data-type="setLimit" ><i class="layui-icon">&#xe679;</i>授权</button>
          </div>
          <div style="width: 300px; overflow: hidden;">
            <ul id="treeDemo" class="ztree"></ul>
          </div>
        </div>
      </div>
    </div>
    <div class="layui-col-md9 md3-right">
      <div class="layui-card h100">
        <div class="layui-form layui-card-header layuiadmin-card-header-auto" lay-filter="layadmin-useradmin-formlist">
          <form class="layui-form">
            <div class="layui-form-item">
              <div class="layui-inline">
                <label class="layui-form-label">用户名</label>
                <div class="layui-input-block">
                  <input type="text" name="name" placeholder="请输入" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-inline">
                <label class="layui-form-label">真实姓名</label>
                <div class="layui-input-block">
                  <input type="text" name="trueName" placeholder="请输入" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-inline">
                <button class="layui-btn layuiadmin-btn-admin" lay-submit lay-filter="LAY-user-back-search">
                  <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                </button>
              </div>
            </div>
          </form>
        </div>

        <div class="layui-card-body">
          <div class="layui-card-body">
            <div style="padding-bottom: 10px;">
              <button class="layui-btn layuiadmin-btn-admin" data-type="putUser">引入用户</button>
              <button class="layui-btn layuiadmin-btn-admin" data-type="delAll">移除用户</button>
            </div>
            <div style="height: 650px;">
              <table id="demo" lay-filter="demo"></table>
            </div>
            <div id="page"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--操作列模板-->
<script type="text/html" id="barDemo">
  {{# if(d. isLeader == 1){ }}
  <a class="layui-btn layui-btn layui-btn-xs" lay-event="changeLeader">取消组长 </a>
  {{#} else  if(d. isLeader == 0){ }}
  <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="changeLeader">设为组长</a>
  {{# } }}
</script>


<!--弹出层模板（新增，查看，编辑）-->
<script type="text/html"  id="tableDataTemplate">
  <form class="layui-form" lay-filter="editForm">
    <div class="layui-card">
      <div class="layui-card-body">
        <div class="layui-form-item">
          <label class="layui-form-label">所属机构:</label>
          <div class="layui-input-block" id='select'>
            <select class="layui-input" lay-verify="required" id="companyName" name="companyId" >
              <option value="0" selected>请选择机构</option>
            </select>
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">父级名称:</label>
          <div class="layui-input-block">
            <input type="text" name="parentName" readonly autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">组织名称:</label>
          <div class="layui-input-block">
            <input type="text" name="name" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
            <span class="bitianspan">必填</span>
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">组织描述:</label>
          <div class="layui-input-block">
            <input type="text" name="desc" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">组织地址:</label>
          <div class="layui-input-block">
            <input type="text" name="address" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">手机号码:</label>
          <div class="layui-input-block">
            <input type="text" name="mobile" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">座机号码:</label>
          <div class="layui-input-block">
            <input type="text" name="phone" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">组织QQ:</label>
          <div class="layui-input-block">
            <input type="text" name="qq" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">组织邮箱:</label>
          <div class="layui-input-block">
            <input type="text" name="email" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">组织编码:</label>
          <div class="layui-input-block">
            <input type="text" name="code" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <input hidden="hidden" name="id">
        <div class="button-bar">
            <button class="layui-btn" lay-submit lay-filter="addUser">确认</button>
            <button class="layui-btn" type="button" data-type="close">取消</button>
        </div>
      </div>
    </div>
    <input type="hidden" name="parentId">
  </form>
</script>

<!--弹出层模板（新增，查看，编辑）-->
<script type="text/html"  id="userTpl">
  <form class="layui-form" lay-filter="editUserForm" style="padding-top: 10px;">
    <div class="layui-form-item">
      <label class="layui-form-label">组织:</label>
      <div class="layui-input-block">
        <input type="text" name="groupName" lay-verify="required" readonly autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">用户名:</label>
      <div class="layui-input-block">
        <input type="text" name="name" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
        <span class="bitianspan">必填</span>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">用户昵称:</label>
      <div class="layui-input-block">
        <input type="text" name="nickName" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
        <span class="bitianspan">必填</span>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">用户密码:</label>
      <div class="layui-input-block">
        <input type="password" name="passWord" lay-verify="pass" placeholder="请输入" autocomplete="off" class="layui-input">
        <span class="bitianspan">必填</span>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">电子邮箱:</label>
      <div class="layui-input-block">
        <input type="text" name="email" lay-verify="email" placeholder="请输入" autocomplete="off" class="layui-input">
        <span class="bitianspan">必填</span>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">真实姓名:</label>
      <div class="layui-input-block">
        <input type="text" name="trueName" placeholder="请输入" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">联系电话:</label>
      <div class="layui-input-block">
        <input type="text" name="tellPhone" placeholder="请输入" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">详细地址:</label>
      <div class="layui-input-block">
        <input type="text" name="address" placeholder="请输入" autocomplete="off" class="layui-input">
      </div>
    </div>
    <input hidden="hidden" name="id">
    <div class="button-bar">
      <button class="layui-btn" lay-submit lay-filter="addUser">确认</button>
      <button class="layui-btn" type="button" data-type="close">取消</button>
    </div>
    <input type="hidden" name="groupId">
  </form>
</script>

<script type="text/html" id="uploadTemplate">
  <div class="layui-upload-drag" id="test10">
    <i class="layui-icon"></i>
    <p>点击上传，或将文件拖拽到此处</p>
  </div>
</script>

<!--弹出层模板（删除）-->
<script type="text/html"  id="delTableTemplate">
  <br><p>&emsp;&emsp;是否删除数据</p>
  <input hidden="hidden" value="{{d.ids}}">
</script>
<!--注销-->
<script type="text/html"  id="setStatus">
  <br><p>&emsp;&emsp;<span id="tempStatus"></span></p>
  <input hidden="hidden" value="{{d.ids}}">
</script>
<script type="text/html" id="putUserTpl">
  <div class='layui-card' style='height:350px;border-bottom:2px solid #333'>
    <div class='layui-row'>
      <div class='layui-col-md3 md3-left'>
        <div class='layui-card'>
          <div class='layui-card-body' style='height:330px;overflow:hidden;'>
            <div style="height: 305px;">
              <ul id="treeDemo2" class="ztree" style="width: 100%;height: 100%;"></ul>
            </div>
          </div>
        </div>
      </div>
      <div class='layui-col-md9 md3-right'>
        <div class='layui-card'>
          <div class='layui-card-body' style='height:330px;overflow:hidden;'>
            <form class='layui-form' style='position:relative'>
              <div class="layui-form-item" style='display:inline-block'>
                <label class="layui-form-label" style="width:84px;padding:0;line-height:36px;">是否在组织：</label>
                <div class="layui-input-block"  style='margin-left:85px;width:80px;'>
                  <select name="interest" lay-filter="aihao">
                    <option value="2">全部</option>
                    <option value="3">是</option>
                    <option value="0" selected>否</option>
                  </select>
                </div>
              </div>
              <div class="layui-form-item" style='display:inline-block'>
                <label class="layui-form-label" style="width:84px;padding:0;line-height:36px;">用户名：</label>
                <div class="layui-input-block"  style='margin-left:85px;width:80px;'>
                  <select name="interest" lay-filter="aihao">
                    <option value="2" selected>全部</option>
                    <option value="3">用户名</option>
                    <option value="0">真实姓名</option>
                  </select>
                </div>
              </div>
              <div class="layui-form-item" style='display:inline-block'>
                <div class="layui-input-block" style='margin-left:15px;width:150px;'>
                  <input type="text" class='layui-input'>
                </div>

              </div>
              <button class='layui-btn' style='display:inline-block;position:absolute;top:0;margin-left:15px;'><i class='layui-icon layui-icon-search'></i></button>
            </form>
            <table class="layui-hide" id="test1" lay-filter="test1"></table>
            <div id="page2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class='layui-card' style='height:400px;'>
    <div class='layui-card-header' style='border:0'>待入库选项</div>
    <div class='layui-card-body'>
      <table class="layui-hide" id="test"></table>
      <div class='layui-btn-container' style='margin:20px 0 0 708px;'>
        <button class='layui-btn' id="putUserBtn">确定</button>
        <button class="layui-btn layui-btn-primary" data-type="close">取消</button>
      </div>
    </div>
  </div>
</script>
<script>
  var url = "/manage/group";
  var baseOrder = [];
  var tempSize = 15;
  var modelObj = {};
  var treeNode = {};
  var groupObj={}
  var seaName;
  var trueName1;
</script>
<script>
  layui.form.on("submit(addUser)",function(data){
    var thisurl = url;
    var type = "post";
    var msg = "新建失败";
    ajax(thisurl,type,JSON.stringify(data.field)).then(res=>{
      if(res.success){
//        res.msgConfig = msgConfig;
          layer.closeAll();
          getData();
      }else{
          layer.alert(msg);
      }
    }).catch(res=>{
    })
    return false;
  })

  layui.form.on("submit(LAY-user-back-search)",function(data){
      console.log(data);
      seaName = data.field.name;
      trueName1 = data.field.trueName;
    doList(1,data.field);
    return false;
  })
  function checkChoice(){
      if(!groupObj.id){
          layer.alert("请选择组织")
          return false;
      }
      return true;
  }
  active.setLimit = function(){
      if(checkChoice()) {
         setLimit(groupObj.id,groupObj.name,2)
      }
      ajax("/manage/limit/type/getAll","post",JSON.stringify({})).then(res=>{
          res.obj.forEach(function (data) {
          var $div = '<li>'+data.name+'</li>';
          $("#getAllLimit").append($div);
      })
  })
  }

  function changeLeader(data){
    ajax("/manage/grpUser/changeLeader", "post", JSON.stringify(data.grpUserId)).then(res =>{
      doList(1, 15)
    })
  }
  function getCompanyName() {
      var jsondata = {
          "pager": {
              "current": 1,
              "size": 1000
          }
          ,"entity": {
              "mark":9,
              "name": $('#nameId').val()
          }
      }
      $.ajax({
          type: "post",
          url: "/manage/company/list",
          contentType: "application/json",
          data: JSON.stringify(jsondata),
          dataType: "json",
          success: function (data) {
              var records = data.obj.records;
              var companyName;
              var i;
              for(i in records){
                  companyName += '<option value="'+records[i].id+'">'+records[i].name+' </option>';

              }
              $("#companyName").append(companyName);


              layui.form.render();

          },
          error: function (data) {
              console.log(data.msg)
          }
      })
  }

  //渲染数据到table
  function setTableData(data) {
    var records = data.records;
    if(groupObj.id){
      layui.table.render({
        elem: '#demo'
        ,data:records
        ,limit:15
        ,cols: [[
          {type:'checkbox'}
          ,{type:'numbers',title: '序号',align: 'right'}
          ,{field:'name',  title: '用户名',align: 'left'}
          ,{field:'trueName',  title: '真实姓名',align: 'left'}
          ,{field:'status',  title: '当前状态',templet:"#state",align: 'left'}
          ,{field:'', width:100, title: '操作',toolbar: '#barDemo',align: 'left'}
        ]]
      });
    }else{
      layui.table.render({
        elem: '#demo'
        ,data:records
        ,limit:15
        ,cols: [[
          {type:'checkbox'}
          ,{type:'numbers',title: '序号',align: 'right'}
          ,{field:'name',  title: '用户名',align: 'left'}
          ,{field:'trueName',  title: '真实姓名',align: 'left'}
          ,{field:'status',  title: '当前状态',templet:"#state",align: 'left'}
        ]]
      });
    }

    page(data.total,data.current,tempSize);
  }

  //设置弹出层数据（新增，查看，修改）
  function setOpenData(data,type) {

    layui.layer.open({
      type: 1,
      title:(data.id?"编辑":"添加")+"编辑组织",
      area:['500px','550px'],
      anim: 2,
      content: '<div id="table_data" class="userForm"></div>',
    });
    layui.laytpl($("#tableDataTemplate").html()).render(data, function(html){
      $("#table_data").html(html)
      layui.form.val('editForm', data);
    });
  }

  layui.form.verify({
    pass: [
      /^[\S]{6,16}$/,
      '密码必须6到16位，且不能出现空格'
    ],
    pwd2: function (value) {
      var pwd1 = $("input[name=passWord]").val();
      if (pwd1 != value) {
        return "两次密码输入不一致，请重新输入"
      }
    }

  });

  //监听操作列工具条
  layui.table.on('tool(demo)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
    var data = obj.data; //获得当前行数据
    var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
    var tr = obj.tr; //获得当前行 tr 的DOM对象

    if(layEvent === 'detail'){ //查看
      setOpenData(data,0);
    } else if(layEvent === 'del'){ //删除
      layer.alert("确定删除:["+data.name+"]",function(){
        doDeleteByIds([data.id]);
      })
    } else if(layEvent === 'edit'){ //编辑
      data.editType = 1;
      setOpenData(data,1);
    }else if(layEvent=='limit'){//权限
      setLimit(data);
    }else if(layEvent === 'changeLeader'){ //设置取消组长
      changeLeader(data);
    }
  });

  active.addUser = function(){
    if(!modelObj.id||modelObj.id == 0){
      layer.alert("请选择组织");
    }else {
      layui.layer.open({
        type: 1,
        title: "新建用户",
        area: ['530px', '500px'],
        anim: 2,
        content: '<div id="table_data" class="userForm"></div>',
      });
      layui.laytpl($("#userTpl").html()).render({}, function (html) {
        $("#table_data").html(html)
        layui.form.val('editUserForm', {groupId:modelObj.id,groupName:modelObj.name});
      });
    }
  }

  active.putUser = function(){
    var grpId;
    layer.open({
      type: 1,
      area: ['905px', '820px'],
      title:'引入用户',
      maxmin: true,
      content: '<div id="putUserView"></div>'
    });
    layui.laytpl($("#putUserTpl").html()).render({}, function(html){
      $("#putUserView").html(html);
    })

    var settings = {
      data: {
        simpleData: {
          enable: true,  //true 、 false 分别表示 使用 、 不使用 简单数据模式
          idKey: "id",  //节点数据中保存唯一标识的属性名称
          pIdKey: "parentId",    //节点数据中保存其父节点唯一标识的属性名称
          rootPId: -1  //用于修正根节点父节点数据，即 pIdKey 指定的属性值
        }
      },
      view: { showLine: false,showIcon:true },
      callback: {
        onClick:setGrpId
      }
    };

    function setGrpId(event, treeId, treeNode){
      grpId = treeNode.id;
    }

    zTreeObj = $.fn.zTree.init($("#treeDemo2"), settings, treeNode); //初始化树
    zTreeObj.expandAll(false); //true 节点全部展开、false节点收缩

    layui.form.render();

    layui.table.render({
      elem: '#test1'
      ,data:[]
      ,cols: [[
        {type:'checkbox'}
        ,{type:'numbers', width:80, title: '序号'}
        ,{field:'name', width:190, title: '用户名'}
        ,{field:'trueName', width:190, title: '真实姓名'}
        ,{field:'state', width:180, title: '当前状态'}
      ]]
    });

    layui.table.render({
      elem: '#test'
      ,data:[]
      ,limit:5
      ,cols: [[
        {type:'checkbox'}
        ,{type:'numbers', width:80, title: '序号'}
        ,{field:'name', width:165, title: '用户名'}
        ,{field:'trueName', width:165, title: '真实姓名'}
        ,{field:'state', width:171, title: '当前状态'}
      ]]
      ,page:true
    });

    var checkData = [];
    layui.table.on('checkbox(test1)', function(obj){
      if(obj.checked){
        checkData.push(obj.data);
      }else{
        for(var i in checkData){
          if(checkData[i].id == obj.data.id){
            checkData.splice(i,1);
            break;
          }
        }
      }
      showTable3(checkData);
    });

    $("#putUserBtn").on("click",function(){
      if(!grpId){
        layer.alert("请选择组织!");
        return false;
      }
      if(checkData.length <= 0){
        layer.alert("请选择用户!");
        return false;
      }
      var userId = [];
      for(var i in checkData){
        userId.push(checkData[i].id);
      }
      ajax("/manage/grpUser/addUserOrgan",'get',{userIds:userId.join(","),organId:grpId}).then(res=>{
        if(res.success){
            layer.closeAll();
        }else{
            layer.alert("引入失败");
        }
        doList(1);
      })
    })

    doList2(1);
  }

</script>
<script>
  function del(){
    if(!groupObj.id||groupObj.id == 0){
      layer.alert("请选择组织");
    }else{
      layer.open({
        content: "确认删除组织:["+groupObj.name+"]及该组织下级组织吗"
        ,btn: ['确认',"取消"]
        ,yes: function(index, layero){
          ajax(url+"/"+groupObj.id,"delete",{}).then(res=>{
            if(res.success){
//              res.msgConfig = "删除成功";
                  getData();
                  layer.closeAll();
            }
            else{
                layer.alert("删除失败");
              }
          }).catch(res=>{

          })
        }
        ,btn2: function(index, layero){
          layer.closeAll();
        }
      });
    }
  }
  //根据ids批量删除
  function delAll(data) {
    var data = getTableCheck("demo");
    var ids = [];
    data.forEach(res => {
      ids.push(res.grpUserId);
    })
    if(data){
      ajax("/manage/grpUser/delByIds","post",JSON.stringify(ids.join(","))).then(res=>{
        if(res.success){
            doList(1);
            layer.closeAll();
        }else{
            layer.alert("移除失败");
        }
      }).catch(res=>{

      })
    }
  }
  function add(){
    var parent = {};
    if(groupObj.id){
      parent.parentId = groupObj.id;
      parent.parentName = groupObj.name;
    }else{
      parent.parentId = 0;
      parent.parentName = "根目录";
    }
    setOpenData(parent,2);

      getCompanyName();
  }
  function edit(){
    if(modelObj.id){
      setOpenData(modelObj,0);
    }else{
      layer.alert("请选择数据");
    }
    // setOpenData({parentId:0,parentName:"根目录"},2);
  }
  //条件列表查询
  function doList(current) {
    var sortProps = [];
    var data={};
    data.pager = {current:current,size:tempSize};
    data.pager.sortProps = sortProps;
    data.entity = {groupId:groupObj.id,name:seaName,trueName:trueName1};

    ajax("/manage/user/list","post",JSON.stringify(data)).then(res=>{
      setTableData(res.obj);
    })
  }
  function tree(){
    ajax(url+"/tree","post",{}).then(res=>{
      treeNode = res.obj;
      getModelObj(res.obj[0].id).then(group=>{
        //modelObj = group.obj;
        doList(1);
      });
      for(var i in res.obj){
        if(res.obj[i].parentId == 0){
          res.obj[i].icon = "/img/u5548.png";
        }else{
          res.obj[i].icon = "/img/u5554.png";
        }
      }
      showTree(res.obj);
    }).catch(res=>{

    })
  }
  //根据id查询数据
  function getModelObj(id) {
    return new Promise((resovle, reject) => {
      ajax(url+"/"+id,"get",{}).then(res=>{
        resovle(res);
      }).catch(res=>{
        reject(res);
      })
    })
  }
  function getData() {
    tree();
  }

  //条件列表查询
  function doList2(current) {
    var sortProps = [];
    var data={};
    data.pager = {current:current,size:5};
    data.pager.sortProps = sortProps;
    data.entity = {groupId:''};

    ajax("/manage/user/list","post",JSON.stringify(data)).then(res=>{
      layui.table.reload("test1",{data:res.obj.records});
      page2(res.obj.total,res.obj.current,5);
    }).catch(res=>{
      layer.msg(JSON.stringify(res));
    })
  }

  function showTable3(data){
    layui.table.reload("test",{data:data});
  }

</script>

<script>
  $(function(){
    getData();
    $('#searchButton').click(function() {
      doList(1);
    })
    layui.form.render();
  });
</script>

<script>
  //ztree

  var settingss = {
    data: {
      simpleData: {
        enable: true,  //true 、 false 分别表示 使用 、 不使用 简单数据模式
        idKey: "id",  //节点数据中保存唯一标识的属性名称
        pIdKey: "parentId",    //节点数据中保存其父节点唯一标识的属性名称
        rootPId: -1  //用于修正根节点父节点数据，即 pIdKey 指定的属性值
      }
    },
    view: { showLine: false,showIcon:true },
    callback: {
      onClick: zTreeOnClick
    }
  };

  //渲染树结构
  function showTree(data) {
    zTreeObj = $.fn.zTree.init($("#treeDemo"), settingss, data); //初始化树
    zTreeObj.expandAll(false);    //true 节点全部展开、false节点收缩
  }

  function zTreeOnClick(event, treeId, treeNode) {
    getModelObj(treeNode.id).then(res=>{
      groupObj = res.obj;
      modelObj.parentName = treeNode.getParentNode()?treeNode.getParentNode().name:"";
      doList(1);
    });
  };

  layui.form.render();

</script>
<script type="text/html" id="state">
  <span>已开通</span>
</script>