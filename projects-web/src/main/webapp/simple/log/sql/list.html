
<title>sql日志</title>
<style>
    #nav span,.right span{display: none;}
    #nav a{display: inline-block;width: 40px;height: 56px;text-align: center;border: 1px solid #f5f5f5;}
    #nav a:nth-of-type(3){display: inline-block;width: 170px;height: 52px; text-align: left;padding-left: 20px;border-top: 2px solid #000;font-weight: bold;}
    .right{display: inline-block;position: absolute;top: 0;right: 0;}
    .layui-breadcrumb a{color: #000!important;}
    .layui-card .layui-table-view{margin: 60px 0 20px 0;}
</style>
<div class="layui-card layadmin-header">
    <div class="layui-breadcrumb" lay-filter="breadcrumb" id="nav">
        <a><i class="layui-icon layui-icon-prev"></i></a>
        <a lay-href=''><i class="layui-icon layui-icon-home"></i></a>
        <a>SQL日志<i class="layui-icon layui-icon-close" style="margin-left: 50px"></i></a>
        <div class="right">
            <a><i class="layui-icon layui-icon-next"></i></a>
            <a><i class="layui-icon layui-icon-down"></i></a>
        </div>
    </div>
</div>
<div class="layui-fluid">
    <div class="layui-card" style="height: 760px;">
        <div class="layui-card-body">
            <form class="layui-form" style="float: right;margin-right:100px;">
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <input id="content" type="text" name="title" required  lay-verify="required" placeholder="原始消息" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </form>
            <button onclick="getSqlLog(1)" class="layui-btn" style="display: inline-block;float:right;margin-right: -350px;"><i class="layui-icon">&#xe615;</i></button>
            <table class="layui-hide" id="test" style="margin-top: 100px;"></table>
            <div id="demo8"></div>
        </div>
    </div>
</div>
<script>
    var pageSize = 15;
    $(function () {
        getSqlLog(1);
    })
    function getSqlLog(pageNo) {
        var jsondata={
            "pager":{
                "current":pageNo,
                "size":pageSize
            },
            "entity":{
                "cruser":$("#content").val()
            }
        }
        ajax("/log/sqlLog/list","POST",JSON.stringify(jsondata)).then(data=>{
            console.log(data);
            layui.use(['table','laypage'],function () {
                var table=layui.table
                    ,laypage=layui.laypage;
                table.render({
                    elem:'#test'
                    ,data:data.obj.records
                    ,cols: [[
                        {type:'numbers',title: '序号'}
                        ,{field:'crUser', width:193, title: '用户名'}
                        ,{field:'address', width:200, title: 'IP地址'}
                        ,{field:'modifyTime',title:"耗时",width:200}
                        ,{field:'content', title: '原始消息', width: 800}
                        ,{field:'createTime', title: '创建时间', width:200}
                    ]]
                    ,limit: pageSize
                })
                laypage.render({
                    elem:'demo8'
                    ,count:data.obj.total
                    ,curr:data.obj.current
                    ,limit:pageSize
                    ,layout:['count','prev','page','next','refresh','skip']
                    ,jump:function (obj,first) {
                        if (!first){
                            getSqlLog(obj.curr);
                        }
                    }
                })
            })
        });
    }
</script>