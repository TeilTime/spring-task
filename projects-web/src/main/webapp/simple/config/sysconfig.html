<title>系统配置</title>
<style>
    #nav span, .right span {
        display: none;
    }

    #nav a {
        display: inline-block;
        width: 40px;
        height: 56px;
        text-align: center;
        border: 1px solid #f5f5f5;
    }

    #nav a:nth-of-type(3) {
        display: inline-block;
        width: 170px;
        height: 52px;
        text-align: left;
        padding-left: 20px;
        border-top: 2px solid #000;
        font-weight: bold;
    }

    .right {
        display: inline-block;
        position: absolute;
        top: 0;
        right: 0;
    }

    .layui-breadcrumb a {
        color: #000 !important;
    }

    .layui-btn-container, .layui-form {
        display: inline-block;
    }

    .layui-form {
        margin-left: 900px;
    }

    /* .layui-layer-page .layui-layer-content{overflow: hidden;} */
</style>
<div class="layui-card layadmin-header">
    <div class="layui-breadcrumb" lay-filter="breadcrumb" id="nav">
        <a><i class="layui-icon layui-icon-prev"></i></a>
        <a lay-href=''><i class="layui-icon layui-icon-home"></i></a>
        <a>系统配置<i class="layui-icon layui-icon-close" style="margin-left: 50px"></i></a>
        <div class="right">
            <a><i class="layui-icon layui-icon-next"></i></a>
            <a><i class="layui-icon layui-icon-down"></i></a>
        </div>
    </div>
</div>
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body" style="height: 782px;">
            <div class="layui-btn-container">
                <button class="layui-btn" data-method="add">添加配置项</button>
                <button class="layui-btn" data-method="edit">修改配置项</button>
                <button class="layui-btn" data-method="del">删除配置项</button>
            </div>
            <form class="layui-form">
                <div class="layui-form-item">
                    <label class="layui-form-label">属性名:</label>
                    <div class="layui-input-block">
                        <input id="nameId" type="text" class="layui-input" placeholder="请输入" autocomplete="off">
                    </div>
                </div>
            </form>
            <button class="layui-btn" style="display: inline-block;position:absolute;top:10px;margin-left:10px;"
                    onclick="getRouteList()"><i class="layui-icon layui-icon-search"></i></button>
            <table class="layui-hide" id="test"></table>
        </div>
    </div>
</div>
<script type="text/html" id="options">
    <div class='layui-card'>
        <div class='layui-card-body'>
            <form class='layui-form' lay-filter="editForm" style='margin-left:10px;margin-top:20px;'>
                <div class='layui-form-item'>
                    <span>所属模块</span>
                    <span style='margin-left:20px; color:#009688'>路径配置</span>
                </div>
               <!-- <div class='layui-form-item'>
                    <label class='layui-form-label' style='margin-left:-25px;padding:9px 0'>模块标识</label>
                    <div class='layui-input-block' style='margin-left:78px;width:335px;'>
                        <input type="text" name="mark" class='layui-input' placeholder='请输入'>
                    </div>
                </div>-->
                <div class='layui-form-item'>
                    <label class='layui-form-label' style='margin-left:-25px;padding:9px 0'>属性名</label>
                    <div class='layui-input-block' style='margin-left:78px;width:335px;'>
                        <input type="text" name="name" class='layui-input' placeholder='请输入'>
                    </div>
                </div>
                <div class='layui-form-item'>
                    <label class='layui-form-label' style='margin-left:-25px;padding:9px 0'>属性值</label>
                    <div class='layui-input-block' style='margin-left:78px;width:335px;'>
                        <input type="text" name="value" class='layui-input' placeholder='请输入'>
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label" style='margin-left:-25px;padding:9px 0'>描述</label>
                    <div class="layui-input-block" style='margin-left:78px;width:335px;'>
                        <textarea name="describe" placeholder="请输入描述" class="layui-textarea" ></textarea>
                    </div>
                </div>
                <div class='layui-form-item'>
                    <label class='layui-form-label' style='margin-left:-25px;padding:9px 0'>创建者</label>
                    <div class='layui-input-block' style='margin-left:78px;width:335px;'>
                        <input type="text" name="CRUSER" class='layui-input' placeholder='请输入'>
                    </div>
                </div>
                <input hidden="hidden" name="mark" value="5">
                <input hidden="hidden" name="id">
                <div class='layui-btn-container' style='margin:0px 0 0 285px;'>
                    <button type="button" class='layui-btn' lay-submit lay-filter ="addRoute">确定</button>
                    <button type="button" class="layui-btn layui-btn-primary" data-type="close">取消</button>
                </div>
            </form>
        </div>
    </div>
</script>
<script>
    var url = "/config/route";
    var routeIndex;
    $(function () {
        getRouteList();
    })

    layui.form.on("submit(addRoute)",function (data) {
        // console.log(JSON.stringify(data.field))
        var id=data.field.id;
        if(id===""||id===null){
            var type="post";
            var thisUrl=url;
            var msg="添加成功";
        }else{
            type="put";
            thisUrl=url+"/"+id;
            msg="修改成功";
        }
        ajax(thisUrl,type,JSON.stringify(data.field)).then(res=>{
            if(res.success){
            res.msg=msg;
            layer.alert(res.msg)
            layer.close(routeIndex)
            getRouteList();
        }
    }).catch(res=>{
        })
        return false;
    })

    function getRouteList() {
        var jsondata = {
            "pager": {
                "current": 1,
                "size": 15
            }
            ,"entity": {
                "mark":5,
                "name": $('#nameId').val()
            }
        }
        $.ajax({
            type: "post",
            url: url + "/list",
            contentType: "application/json",
            data: JSON.stringify(jsondata),
            dataType: "json",
            success: function (data) {
                //console.log(data)
                layui.table.render({
                    elem: '#test'
                    , data: data.obj.records
                    // ,data:[
                    //     {num:1,attr:"daochu",value:"E:/WORK/JMETDATA/daochu/",description:"excel导出的文件路径",creator:"admin",time:"2018-01-23 16:56:09"},
                    //     {num:2,attr:"huiyitong",value:"E:/WORK/JMETADATA/pub/huiyitong/",description:"会议通发布地址",creator:"admin",time:"2017-08-20 00:00:00"},
                    //     {num:3,attr:"metafilepath",value:"E:/WORK/JMETADATA/metatemplate",description:"元数据上次模板",creator:"admin",time:"2016-07-29 09:46:10"},
                    //     {num:4,attr:"usertemp",value:"E:/WORK/JMETDATA",description:"用户临时文件目录",creator:"admin",time:"2016-07-14 10:23:19"},
                    //     {num:5,attr:"video",value:"E:/WORK/JMETDATA/video",description:"这是存储视频文件",creator:"admin",time:"2015-09-05 14:06:04"},
                    //     {num:6,attr:"systemp",value:"E:/WORK/JMETDATA/system",description:"这个是临时文件路径",creator:"admin",time:"2015-08-25 12:16:28"},
                    //     {num:7,attr:"preview",value:"E:/WORK/JMETDATA/preview",description:"jnetcms的预览的目录",creator:"admin",time:"2014-09-04 00:00:00"},
                    //     {num:8,attr:"pub",value:"E:/WORK/JMETDATA/pub",description:"jnetcms的发布后的结果的目录",creator:"admin",time:"2014-09-04 00:00:00"},
                    //     {num:9,attr:"upload",value:"E:/WORK/JMETDATA/upload",description:"jnetcms的非图片的上传目录",creator:"admin",time:"2014-09-04 00:00:00"},
                    //     {num:10,attr:"JMETDATA",value:"E:/WORK/JMETDATA",description:"jnetcms的JMETADATA的目录",creator:"admin",time:"2014-09-04 00:00:00"},
                    //     {num:11,attr:"template",value:"E:/WORK/JMETDATA/template",description:"<div>jnetcms模板上传zip文件解压后的文<br>件存放目录</div>",creator:"admin",time:"2014-09-04 00:00:00"},
                    //     {num:12,attr:"webpic",value:"E:/WORK/JMETDATA/webpic",description:"jnetcms的上传图片目录",creator:"admin",time:"2014-09-04 00:00:00"},
                    //     {num:13,attr:"zip",value:"E:/WORK/JMETDATA/zip",description:"jnetcms的zip和rar文件存放目录",creator:"admin",time:"2014-09-04 00:00:00"}
                    // ]
                    , cols: [[
                        {type: 'checkbox'}
                        , {type: 'numbers', width: 120, title: '序号'}
                        , {field: 'name', width: 320, title: '属性名'}
                        , {field: 'value', width: 320, title: '属性值'}
                        , {field: 'describe', width: 300, title: '描述'}
                        , {field: 'crUser', title: '创建人', width: 250}
                        , {field: 'createTime', width: 250, title: '创建时间'}
                    ]]
                    ,limit:15
                });
            },
            error: function (data) {
                console.log(data.msg)
            }
        })
    }

    layui.use('layer', function () { //独立版的layer无需执行这一句
        var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句

        //触发事件
        var active = {
            add: function () {
                var that = this;
                //多窗口模式，层叠置顶
                routeIndex = layer.open({
                    type: 1 //此处以iframe举例
                    , title: '添加配置项'
                    , area: ['502px', '452px']
                    , shade: 0.6
                    , maxmin: true
                    , content: "<div id='form'> </div>"
                });
                layui.laytpl($("#options").html()).render({}, function (html) {
                    $("#form").html(html);
                    layui.form.render();
                })
            },
            edit: function () {
                var data=layui.table.checkStatus("test").data
                if (data.length===0){
                    layer.alert("请选择要修改的数据")
                    return false;
                }
                if (data.length>1){
                    layer.alert("请选择一条数据")
                    return false;
                }
                routeIndex = layer.open({
                    type: 1 //此处以iframe举例
                    , title: '修改配置项'
                    , area: ['502px', '452px']
                    , shade: 0.6
                    , maxmin: true
                    , content: "<div id='form'> </div>"
                });
                layui.laytpl($("#options").html()).render({}, function (html) {
                    $("#form").html(html);
                    layui.form.val('editForm', data[0]);
                })
            },
            del:function () {
                var data=layui.table.checkStatus("test").data
                var ids="";
                for (var i in data){
                    ids=ids+data[i].id;
                    if(i<data.length-1){
                        ids=ids+",";
                    }
                }
                // console.log(ids)
                if (ids.length===0){
                    layer.alert('请选择要删除的消息')
                    return
                }
                if (confirm("是否确定删除,该操作不可撤回")) {
                    var dataIds = {
                        "ids": ids
                    };
                    $.ajax({
                        type: "get",
                        url: url + "/delByIds",
                        contentType: "application/json",
                        data: dataIds,
                        dataType: "json",
                        success: function (data) {
                            layer.alert(data.msg);
                            getRouteList();
                        },
                        error: function (data) {
                            layer.alert(data.msg)
                        }
                    })
                }
            }

        };

        $('.layui-btn').on('click', function () {
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });

    });
</script>