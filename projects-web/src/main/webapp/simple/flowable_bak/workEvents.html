  <title>工作事项</title>
  <style>
        #nav span,.right span{display: none;}
        #nav a{display: inline-block;width: 40px;height: 56px;text-align: center;border: 1px solid #f5f5f5;}
        #nav a:nth-of-type(3){display: inline-block;width: 220px;height: 52px; text-align: left;padding-left: 20px;border-top: 2px solid #000;font-weight: bold;}
        .right{display: inline-block;position: absolute;top: 0;right: 0;}
        .layui-breadcrumb a{color: #000!important;}
        .node_name{color: #000;}
        .ztree li span.button.noline_open {
    background-position: -110px -88px;
}
.ztree li span.button.ico_docu{margin-top: 3px;}
.icon{background: url(./img/icon_gongzuochaxun.png) no-repeat; display: inline-block;width:22px;height: 22px;position: absolute;top:10px;}
  </style>
    <div class="layui-card layadmin-header">
        <div class="layui-breadcrumb" lay-filter="breadcrumb" id="nav">
            <a><i class="layui-icon layui-icon-prev"></i></a>
            <a lay-href=''><i class="layui-icon layui-icon-home"></i></a>
            <a>工作事项<i class="layui-icon layui-icon-close" style="margin-left: 120px"></i></a>
            <div class="right">
            <a><i class="layui-icon layui-icon-next"></i></a>
            <a><i class="layui-icon layui-icon-down"></i></a>
            </div>
        </div>
    </div>
    <div class="layui-fluid" id='fluid1'>
      <div class="layui-card" style="height: 800px;">
        <div class="layui-card-header" style="border-bottom: 2px solid #379ff7">
            <span class="icon"></span>
            <span style="margin-left: 30px;">流程查询</span>
          <div class="layui-btn-container" style="position: absolute;right:10px;top:5px;">
            <button class="layui-btn  layui-btn-sm">批量导出</button>
            <button class="layui-btn  layui-btn-sm">导出EXCEL</button>
            <button class="layui-btn  layui-btn-sm" onclick="check()">归档查询</button>
            <button class="layui-btn layui-btn-danger layui-btn-sm">批量删除</button>
          </div>
        </div>
        <div class="layui-card-body">
          <form class="layui-form">
            <div class="layui-form-item" style="display: inline-block;">
              <label class="layui-form-label">所属流程：</label>
              <div class="layui-input-block">
                <input type="text" class="layui-input" style="width: 216px;" readonly data-method="select" id='selects'>
              </div>
            </div>
            <div class="layui-form-item" style="display: inline-block;">
                <label class="layui-form-label">查询范围：</label>
                <div class="layui-input-block">
                  <select name="" id="">
                    <option value="0" selected>所有范围</option>
                    <option value="1">我发起的</option>
                    <option value="2">我经办的</option>
                    <option value="3">我管理的</option>
                    <option value="4">我关注的</option>
                    <option value="5">我查阅的</option>
                    <option value="6">指定发起人</option>
                  </select>
                </div>
              </div>
              <div class="layui-form-item" style="display: inline-block;">
                  <label class="layui-form-label">流程状态：</label>
                  <div class="layui-input-block">
                    <select name="" id="">
                      <option value="0" selected>所有状态</option>
                      <option value="1">执行中</option>
                      <option value="2">已结束</option>
                    </select>
                  </div>
                </div>
          </form>
          <form class="layui-form">
              <div class="layui-form-item" style="display: inline-block;">
                <label class="layui-form-label">流水号：</label>
                <div class="layui-input-block">
                  <input type="text" class="layui-input" style="width: 216px;" readonly>
                </div>
              </div>
              <div class="layui-form-item" style="display: inline-block;">
                  <label class="layui-form-label">工作名称：</label>
                  <div class="layui-input-block">
                    <input type="text" class="layui-input" style="width: 216px;" readonly>
                  </div>
                </div>
            </form>
            <table class="layui-hide" id="test"></table>
        </div>
      </div>
    </div>
    <div class="layui-fluid" id='fluid2' style="display: none">
        <div class="layui-card" style="height: 800px;">
            <div class="layui-card-header" style="border-bottom: 2px solid #379ff7">
              归档查询
              <div class="layui-btn-container" style="position: absolute;right:10px;top:5px;">
                <button class="layui-btn  layui-btn-sm" onclick="returnBack()">返回</button>
                <button class="layui-btn  layui-btn-sm">查询</button>
              </div>
            </div>
            <div class="layui-card-body">
                <form class="layui-form">
                    <div class="layui-form-item" style="display: inline-block;">
                        <label class="layui-form-label">归档日期：</label>
                        <div class="layui-input-block">
                          <select name="" id="">
                            <option value="0"></option>
                          </select>
                        </div>
                      </div>
                    <div class="layui-form-item" style="display: inline-block;">
                      <label class="layui-form-label">流水号：</label>
                      <div class="layui-input-block">
                        <input type="text" class="layui-input" style="width: 160px;">
                      </div>
                    </div>
                    <div class="layui-form-item" style="display: inline-block;">
                        <label class="layui-form-label">流程标题：</label>
                        <div class="layui-input-block">
                          <input type="text" class="layui-input" style="width: 160px;">
                        </div>
                      </div>
                      <div class="layui-form-item" style="display: inline-block;">
                          <label class="layui-form-label" style="width: 100px;padding:9px 0;">日期范围：</label>
                          <div class="layui-input-block">
                                  <input type="text" class="layui-input" id="test1" placeholder="yyyy-MM-dd" style='display:inline-block;margin-right:15px;width:160px' readonly>至<input type="text" class='layui-input ' readOnly style='width:160px;display:inline-block;margin-left:15px;' id='test2' placeholder="yyyy-MM-dd" readonly>
                          </div>
                      </div>
                  </form>
              <form class="layui-form">
                <div class="layui-form-item" style="display: inline-block;">
                  <label class="layui-form-label">所属流程：</label>
                  <div class="layui-input-block">
                    <input type="text" class="layui-input" style="width: 216px;" readonly data-method="select" id='selects1'>
                  </div>
                </div>
                <div class="layui-form-item" style="display: inline-block;">
                    <label class="layui-form-label">查询范围：</label>
                    <div class="layui-input-block">
                      <select name="" id="">
                        <option value="0" selected>所有范围</option>
                        <option value="1">我发起的</option>
                        <option value="2">我经办的/option>
                        <option value="3">我管理的</option>
                        <option value="4">我关注的</option>
                        <option value="5">我查阅的</option>
                        <option value="6">指定发起人</option>
                      </select>
                    </div>
                  </div>
              </form> 
                <table class="layui-hide" id="test3"></table>
            </div>
          </div>
    </div>

          

<script>
layui.use('form', function(){
  var form = layui.form;
  
  //监听提交
  form.on('submit(formDemo)', function(data){
    layer.msg(JSON.stringify(data.field));
    return false;
  });
});
layui.use(['form', 'layedit', 'laydate'], function(){
  var form = layui.form
  ,layer = layui.layer
  ,layedit = layui.layedit
  ,laydate = layui.laydate;
  
  //日期
  laydate.render({
    elem: '#test1'
  });
  laydate.render({
    elem: '#test2'
  });
  
  
});
layui.use('table', function(){
  var table = layui.table;
  
  table.render({
    elem: '#test'
    ,data:[
      {num:76,name:"办公室发文(2019-07-09 14:56:14)",belong:"办公室发文",time:"2019-07-09 14:56",person:"系统管理员",state:"1",step:"第1步：发文拟稿"},
      {num:75,name:"办公室发文(2019-07-09 14:54:46)",belong:"办公室发文",time:"2019-07-09 14:56",person:"系统管理员",state:"1",step:"第1步：发文拟稿"},
      {num:73,name:"员工外出申请（业务）(2019-07-05 14:43:01)",belong:"员工外出申请（业务）",time:"2019-07-05 14:43",person:"xsy",state:"1",step:"第1步：外出申请"},
      {num:71,name:"测试111(2019-06-29 11:38:34)",belong:"测试111",time:"2019-06-29 11:38",person:"系统管理员",state:"1",step:"第2步：222"},
      {num:70,name:"测试111(2019-06-29 11:37:11)",belong:"测试111",time:"2019-06-29 11:37",person:"系统管理员",state:"1",step:"第1步：开始"},
      {num:68,name:"签章测试流程(2019-06-25 17:57:51）",belong:"签章测试流程",time:"2019-06-25 17:57",person:"系统管理员",state:"1",step:"第1步：开始"},
      {num:67,name:"签章测试流程(2019-06-25 17:37:58）",belong:"签章测试流程",time:"2019-06-25 17:37",person:"系统管理员",state:"0",step:"第1步：开始"},
      {num:66,name:"合同审批申请（演示）(2019-06-24 14:54）",belong:"合同审批申请（演示）",time:"2019-06-24 14:54",person:"系统管理员",state:"1",step:"第3步：法务部门意见"},
      {num:65,name:"合同审批申请（演示）(2019-06-24 13:17)",belong:"合同审批申请（演示）",time:"2019-06-24 13:17",person:"系统管理员",state:"1",step:"第3步：法务部门意见"},
      {num:64,name:"合同审批申请（演示）(2019-06-24 12:50)",belong:"合同审批申请（演示）",time:"2019-06-24 12:50",person:"系统管理员",state:"1",step:"第3步：法务部门意见"}
    ]
    ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
    ,cols: [[
       {type:'checkbox'}
      ,{field:'num', width:120, title: '流水号', sort: true}
      ,{field:'name', width:300, title: '工作名称',sort: true,templet:"#name"}
      ,{field:'belong', width:185, title: '所属流程', sort: true,templet:"#belong"}
      ,{field:'time', width:150, title: '开始时间',sort:true}
      ,{field:'person', title: '流程发起人', width: 120} //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
      ,{field:'state', title: '状态', sort: true,width:100,templet:"#state"}
      ,{field:'step', title: '当前步骤',width:210}
      ,{field:'classify', title: '操作',width:395,templet:'#operation'}
    ]]
  });
  table.render({
    elem: '#test3'
    ,data:[
    ]
    ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
    ,cols: [[
       {type:'checkbox'}
      ,{field:'num', width:120, title: '流水号', sort: true}
      ,{field:'name', width:300, title: '工作名称',sort: true,templet:"#name"}
      ,{field:'belong', width:285, title: '所属流程', sort: true,templet:"#belong"}
      ,{field:'time', width:250, title: '开始时间',sort:true}
      ,{field:'person', title: '流程发起人', width: 155} //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
      ,{field:'classify', title: '操作',width:450,templet:'#operation'}
    ]]
  });
});
</script>
<script type="text/html" id="state">
  {{#  if(d.state === "1"){ }}
  <span style='color:green'>执行中</span>
  {{#  } else{ }}
  <span style='color:red;'>已结束</span>
  {{#  } }}
</script>
<script type="text/html" id="operation">
  <div class='layui-btn-container'>
      <button class='layui-btn  layui-btn-sm'>详情</button>
      <button class='layui-btn  layui-btn-sm'>流程图</button>
      <button class='layui-btn  layui-btn-sm' data-method='cuiban'>催办</button>
      <button class='layui-btn  layui-btn-sm' data-method='concerned'>关注</button>
      <button class='layui-btn  layui-btn-sm' data-method='end'>结束</button>
      <button class='layui-btn  layui-btn-sm' data-method='delete'>删除</button>
  </div>
</script>
<script type="text/html" id="name">
  <div>
      <a href="#" style='color:#126DBA'>{{d.name}}</a>
  </div>
</script>
<script type="text/html" id="belong">
  <div>
      <a href="#" style='color:#126DBA'>{{d.belong}}</a>
  </div>
</script>
<script type='text/html' id='tips'>
  <div style='text-align:center;line-height:80px;'>是否进行催办提醒？</div>
  <div class='layui-btn-container' style='position:absolute;bottom:5px;right:10px;'>
      <button class='layui-btn layui-btn-primary layui-btn-sm close'>取消</button>
      <button class='layui-btn  layui-btn-sm'>确定</button>
    </div>
</script>
<script type='text/html' id='tips1'>
  <div style='text-align:center;line-height:80px;'>确认关注此工作吗？</div>
  <div class='layui-btn-container' style='position:absolute;bottom:5px;right:10px;'>
      <button class='layui-btn layui-btn-primary layui-btn-sm close'>取消</button>
      <button class='layui-btn  layui-btn-sm'>确定</button>
    </div>
</script>
<script type='text/html' id='tips2'>
  <div style='text-align:center;line-height:80px;'>确认结束此工作吗？</div>
  <div class='layui-btn-container' style='position:absolute;bottom:5px;right:10px;'>
      <button class='layui-btn layui-btn-primary layui-btn-sm close'>取消</button>
      <button class='layui-btn  layui-btn-sm'>确定</button>
    </div>
</script>
<script type='text/html' id='tips3'>
  <div style='text-align:center;line-height:80px;'>确认删除此工作吗？</div>
  <div class='layui-btn-container' style='position:absolute;bottom:5px;right:10px;'>
      <button class='layui-btn layui-btn-primary layui-btn-sm close'>取消</button>
      <button class='layui-btn  layui-btn-sm'>确定</button>
    </div>
</script>
<script type="text/html" id='select'>
    <div class='box' style='height:230px'>
        <ul id="treeDemo" class="ztree" style="width: 390px;height: 220px;"></ul>
    </div>
    <div class='layui-btn-container' style='position:absolute;bottom:10px;right:20px;'>
      <button class='layui-btn ' id='confirm'>确定</button>
      <button class='layui-btn layui-btn-primary close' >关闭</button>
    </div>
</script>
<script>
  layui.use('layer', function(){ 
      var $=layui.jquery ,layer = layui.layer;
      var active={
        end:function(){
              var that = this;
                layer.open({
                type: 1 //此处以iframe举例
                ,title: '提示'
                ,area: ['350px', '164px']
                ,shade: 0.3
                ,maxmin: true
                ,id:"_add"
                ,content: "<div id='form2'></div>"
              });
              layui.laytpl($("#tips2").html()).render({}, function(html){
                  $("#form2").html(html);
                  layui.form.render();
                })
                function close(){
              layer.closeAll();
            }
            var closes = document.querySelector('.close');

            closes.addEventListener('click',close);
            },
            delete:function(){
              var that = this;
                layer.open({
                type: 1 //此处以iframe举例
                ,title: '提示'
                ,area: ['350px', '164px']
                ,shade: 0.3
                ,maxmin: true
                ,id:"_add"
                ,content: "<div id='form3'></div>"
              });
              layui.laytpl($("#tips3").html()).render({}, function(html){
                  $("#form3").html(html);
                  layui.form.render();
                })
                function close(){
              layer.closeAll();
            }
            var closes = document.querySelector('.close');

            closes.addEventListener('click',close);
            },
            cuiban:function(){
              var that = this;
                layer.open({
                type: 1 //此处以iframe举例
                ,title: '提示'
                ,area: ['350px', '164px']
                ,shade: 0.3
                ,maxmin: true
                ,id:"_add"
                ,content: "<div id='form'></div>"
              });
              layui.laytpl($("#tips").html()).render({}, function(html){
                  $("#form").html(html);
                  layui.form.render();
                })
                function close(){
              layer.closeAll();
            }
            var closes = document.querySelector('.close');

            closes.addEventListener('click',close);
            },
            concerned:function(){
              var that = this;
                layer.open({
                type: 1 //此处以iframe举例
                ,title: '提示'
                ,area: ['350px', '164px']
                ,shade: 0.3
                ,maxmin: true
                ,id:"_add"
                ,content: "<div id='form1'></div>"
              });
              layui.laytpl($("#tips1").html()).render({}, function(html){
                  $("#form1").html(html);
                  layui.form.render();
                })
                function close(){
              layer.closeAll();
            }
            var closes = document.querySelector('.close');

            closes.addEventListener('click',close);
            }
      }
      $(document).on('click','.layui-btn', function(){
    var othis = $(this), method = othis.data('method');
    active[method] ? active[method].call(this, othis) : '';
  });
  })
  layui.use('layer', function(){ 
      var layer = layui.layer; 
      var active={

            select:function(){
              var that=this;
              layer.open({
                type: 1 //此处以iframe举例
                ,title: '选择流程'
                ,area: ['400px', '348px']
                ,shade: 0.3
                ,maxmin: false
                ,id:"_add"
                ,content: "<div id='form4'></div>"
              });
              layui.laytpl($("#select").html()).render({}, function(html){
                  $("#form4").html(html);
                  layui.form.render();
                })
               
                var settingss = {
                  callback: {
                  onClick: zTreeOnClick
                },
            data: {
                simpleData: {
                    enable: true, //true 、 false 分别表示 使用 、 不使用 简单数据模式
                    idKey: "id", //节点数据中保存唯一标识的属性名称
                    pIdKey: "parentId", //节点数据中保存其父节点唯一标识的属性名称  
                    rootPId: -1 //用于修正根节点父节点数据，即 pIdKey 指定的属性值
                },
                key: {
                    name: "menuName" //zTree 节点数据保存节点名称的属性名称  默认值："name"
                }
            },
            view: {
                showLine: false,
                showPlusMinus: false,
                showIcon: true,
                dblClickExpand: false,
                fontCss: {
                    'color': 'white',
                    'font-weight': 'normal'
                }
            }
        };

        //数据
        var zNodes = [
            //注意，数据中的 menuName 必须与 settingss 中key 中定义的name一致，否则找不到
            {
                menuName: "全部流程",
                icon: "./img/wf_node2.png",
            },
            {
                menuName: "默认分类",
                icon: "./img/wf_node1.png",
                open: true,
                children:[
                  {
                    menuName: "签章测试流程",
                    icon: "./img/wf_node2.png"
                  },
                  {
                    menuName: "测试111",
                    icon: "./img/wf_node2.png"
                  },
                ]
            },
            {
                menuName: "人事类",
                icon: "./img/wf_node1.png",
                open: true,
                children:[
                  {
                    menuName: "员工外出申请（业务）",
                    icon: "./img/wf_node2.png"
                  }
                ]
            },
            {
                menuName: "费用类",
                icon: "./img/wf_node1.png",
                open: true,
                children:[
                  {
                    menuName: "个人年度费用计划申请（业务）",
                    icon: "./img/wf_node2.png"
                  }
                ]
            },
            {
                menuName: "合同类",
                icon: "./img/wf_node1.png",
                open: true,
                children:[
                  {
                    menuName: "合同审批申请（演示）",
                    icon: "./img/wf_node2.png"
                  }
                ]
            },
            {
                menuName: "公文类",
                icon: "./img/wf_node1.png",
                open: true,
                children:[
                  {
                    menuName: "办公室发文",
                    icon: "./img/wf_node2.png"
                  },
                  {
                    menuName: "办公室收文",
                    icon: "./img/wf_node2.png"
                  }
                ]
            }
        ];

        zTreeObj = $.fn.zTree.init($("#treeDemo"), settingss, zNodes); //初始化树
        zTreeObj.expandAll(true);
        function zTreeOnClick(event, treeId, treeNode) {
            var name = treeNode.menuName;
            $("#confirm").click(function(){
              $('#selects').val(name);
              $('#selects1').val(name);
              layer.closeAll();
            })
            
        };
            function close(){
              layer.closeAll();
            }
            var closes = document.querySelector('.close');

            closes.addEventListener('click',close);
       }
          }
  
  $('.layui-input').focus(function(){
    var othis = $(this), method = othis.data('method');
    active[method] ? active[method].call(this, othis) : '';
  });
  })
  function check(){
    document.getElementById("fluid1").style.display='none';
    document.getElementById("fluid2").style.display='block';
  }
  function returnBack(){
    document.getElementById("fluid1").style.display='block';
    document.getElementById("fluid2").style.display='none';
  }
  
</script>
  <script>
      layui.form.render();
  </script>